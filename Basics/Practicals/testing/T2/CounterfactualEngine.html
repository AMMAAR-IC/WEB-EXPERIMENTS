<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Counterfactual Engine</title>
<style>
  body {
    margin: 0;
    background: #020202;
    color: #7fffd4;
    font-family: monospace;
    overflow: hidden;
  }

  canvas {
    display: block;
  }

  .label {
    position: fixed;
    top: 12px;
    width: 100%;
    text-align: center;
    opacity: 0.5;
    font-size: 13px;
    letter-spacing: 1px;
  }
</style>
</head>
<body>

<canvas id="c"></canvas>
<div class="label">Counterfactual Engine â€” most worlds are never seen</div>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

// ---- World definition ----
class World {
  constructor(noise) {
    this.noise = noise;
    this.x = canvas.width / 2;
    this.y = canvas.height / 2;
    this.vx = (Math.random() - 0.5) * noise;
    this.vy = (Math.random() - 0.5) * noise;
    this.stability = 0;
  }

  step() {
    this.vx += (Math.random() - 0.5) * this.noise;
    this.vy += (Math.random() - 0.5) * this.noise;

    this.x += this.vx;
    this.y += this.vy;

    const cx = canvas.width / 2;
    const cy = canvas.height / 2;
    const dx = this.x - cx;
    const dy = this.y - cy;
    const dist = Math.sqrt(dx*dx + dy*dy);

    // closer to center = more stable
    this.stability += Math.max(0, 300 - dist);
  }
}

// ---- Generate counterfactuals ----
let worlds = [];
for (let i = 0; i < 12; i++) {
  worlds.push(new World(0.4 + Math.random() * 0.6));
}

// One visible world
let current = worlds[0];

function drawWorld(w) {
  ctx.beginPath();
  ctx.arc(w.x, w.y, 3, 0, Math.PI * 2);
  ctx.fillStyle = "#7fffd4";
  ctx.fill();
}

function animate() {
  ctx.fillStyle = "rgba(0,0,0,0.25)";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Step all worlds (most are unseen)
  worlds.forEach(w => w.step());

  // Occasionally switch to a better counterfactual
  if (Math.random() < 0.005) {
    worlds.sort((a,b) => b.stability - a.stability);
    current = worlds[0];
  }

  drawWorld(current);
  requestAnimationFrame(animate);
}

animate();

window.addEventListener("resize", () => {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
});
</script>

</body>
</html>
